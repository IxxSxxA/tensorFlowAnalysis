<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profitto vs Drawdown</title>
    <script src="node_modules/plotly.js-dist-min/plotly.min.js"></script>
</head>
<body>
    <div id="scatter-plot" style="width: 100%; height: 100vh;"></div>
    <script>
        // Funzione per leggere il JSON e creare il grafico
        async function createScatterPlot() {
            // Carica i dati da logs/results_grid_search.json
            const response = await fetch('./logs/results_grid_search.json');
            const data = await response.json();

            // Prepara i dati per Plotly
            const traces = [];
            for (const tf in data) {
                const tfData = data[tf]; // Top 5 configurazioni per timeframe
                const x = tfData.map(d => d.maxDrawdown); // Drawdown
                const y = tfData.map(d => d.totalProfit); // Profitto netto
                const winRate = tfData.map(d => d.winRate * 100); // Win rate in %
                const trades = tfData.map(d => d.trades); // Numero di trade
                const text = tfData.map(d => 
                    `TF: ${tf}m<br>EMA: ${d.emaFast}/${d.emaSlow}<br>MACD: ${d.macd}<br>ADX: ${d.adxPeriod}/${d.adxThreshold}<br>R:R: ${d.rr}<br>Trades: ${d.trades}<br>Win Rate: ${(d.winRate * 100).toFixed(2)}%<br>Profit: ${d.totalProfit.toFixed(2)}%<br>Drawdown: ${d.maxDrawdown.toFixed(2)}%`
                );

                traces.push({
                    x: x,
                    y: y,
                    mode: 'markers',
                    type: 'scatter',
                    name: `${tf}m`,
                    text: text,
                    hoverinfo: 'text',
                    marker: {
                        size: trades.map(t => Math.min(t / 10, 20)), // Dimensione proporzionale ai trade (max 20)
                        color: winRate, // Colore basato su win rate
                        colorscale: 'Viridis', // Scala da blu (basso) a giallo (alto)
                        showscale: true, // Barra dei colori
                        colorbar: { title: 'Win Rate (%)' }
                    }
                });
            }

            // Layout del grafico
            const layout = {
                title: 'Profitto Netto vs Massimo Drawdown',
                xaxis: { title: 'Massimo Drawdown (%)' },
                yaxis: { title: 'Profitto Netto (%)' },
                hovermode: 'closest',
                showlegend: true
            };

            // Crea il grafico
            Plotly.newPlot('scatter-plot', traces, layout);
        }

        // Esegui quando la pagina carica
        window.onload = createScatterPlot;
    </script>
</body>
</html>